<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>Lukasz Wisniewski</title>

    <script defer src="https://use.fontawesome.com/releases/v6.7.2/js/all.js"></script>
    <script defer src="https://cdnjs.cloudflare.com/ajax/libs/js-yaml/4.1.0/js-yaml.min.js"></script>

    <link rel="stylesheet" href="styles/cv.css">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="author" content="Lukasz Wisniewski">
</head>

<body>

<div class="language-buttons">
    <button onclick="switchLang('en')">English</button>
    <button onclick="switchLang('pl')">Polski</button>
</div>

<div id="cv-container">
    <div class="loading">Loading...</div>
</div>

<script>
    let currentLang = 'en';
    let cvData = null;

    function getVersion() {
        const params = new URLSearchParams(globalThis.location.search);
        return params.get('version') || 'it';
    }

    function showError(message) {
        console.error('Error loading content:', message);
        document.getElementById('cv-container').innerHTML =
            '<p class="error">Error loading CV content. Please check that content.yaml is available.</p>';
    }

    async function loadContent() {
        try {
            const version = getVersion();
            const response = await fetch(`content_${version}.yaml`);
            if (!response.ok) {
                showError(`HTTP ${response.status}: ${response.statusText}`);
                return;
            }
            const yamlText = await response.text();
            cvData = jsyaml.load(yamlText);
            renderCV();
        } catch (error) {
            showError(error);
        }
    }

    function renderCV() {
        if (!cvData) return;

        const data = cvData[currentLang];
        const container = document.getElementById('cv-container');

        document.documentElement.lang = currentLang;

        container.innerHTML = `
        <div id="cv">
            <section id="header">
                <div id="name-container">
                    <img id="profile-picture" src="images/my_photo_transparent.png" alt="Photo of ${data.name}"/>
                    <span id="name">${data.name}</span>
                </div>
                <div id="intro">
                    <span>${data.intro}</span>
                </div>
            </section>

            <section id="contact">
                <a class="phoneNumber" href="tel:${data.contact.phone}">
                    <span class="fas fa-phone icon"></span><span>${data.contact.phone}</span>
                </a>
                <a href="mailto:${data.contact.email}">
                    <span class="fas fa-envelope icon"></span><span>${data.contact.email}</span>
                </a>
                <a href="${data.contact.linkedin}" rel="noopener">
                    <span class="fab fa-linkedin icon"></span><span>${extractLinkedInUsername(data.contact.linkedin)}</span>
                </a>
                <span class="contact-location">
                    <span class="fas fa-location-dot icon"></span><span>${data.contact.location}</span>
                </span>
            </section>

            <h1>${data.labels.experience}</h1>
            <section id="experience" class="section-experience">
                ${renderExperience(data.experience)}
            </section>

            <h1>${data.labels.skills}</h1>
            <div class="section-large" id="technology-list">
                ${renderSkills(data.skills)}
            </div>
            <div id="technology-other">
                ${data.skills_other}
            </div>

            <section id="education" class="two-sections">
                <div>
                    <h1>${data.labels.education}</h1>
                    <section class="section-small">
                        ${renderEducation(data.education)}
                    </section>
                </div>
                <div>
                    <h1>${data.labels.certifications}</h1>
                    <section class="section-small">
                        ${renderCertifications(data.certifications)}
                    </section>
                    <h1>${data.labels.language}</h1>
                    <section class="section-small">
                        ${renderLanguages(data.languages)}
                    </section>
                    <h1>${data.labels.disability}</h1>
                    <section class="section-small">
                        ${renderDisabilities(data.disabilities)}
                    </section>
                </div>
            </section>

            <h1 id="work-projects">${data.labels.projects}</h1>
            ${renderProjects(data.projects, data.labels)}
        </div>
    `;
    }

    function extractLinkedInUsername(url) {
        const match = url.match(/linkedin\.com\/in\/([^/]+)/);
        return match ? `linkedin.com/in/${match[1]}` : url;
    }

    function renderDetails(details) {
        if (details.length === 1 && !details[0].includes('â€¢')) {
            return details[0];
        }
        return '<ul>' + details.map(d => '<li>' + d + '</li>').join('') + '</ul>';
    }

    function renderExperience(experiences) {
        return experiences.map(exp => `
        <div class="experience-year">${exp.years}</div>
        <div>
            <span class="experience-position">${exp.position}</span><br/>
            ${exp.company ? `<span class="experience-company">${exp.company}</span><br/>` : ''}
            ${exp.technologies ? `<span class="experience-tech">${exp.technologies}</span><br/>` : ''}
            ${renderDetails(exp.details)}
        </div>
    `).join('');
    }

    function renderSkills(skills) {
        return skills.map(skill => `
        <span class="technology-name">${skill.name}</span>
        <span class="technology-description">${skill.description}</span>
    `).join('');
    }

    function renderEducation(education) {
        return education.map(edu => `
        <div class="education-year">${edu.year}</div>
        <div>
            <span class="education-detail">${edu.detail}</span><br/>
            <span class="education-org">${edu.org}</span><br/>
        </div>
    `).join('');
    }

    function renderCertifications(certifications) {
        if (!certifications) return '';
        return certifications.map(cert => `
        <div class="certification-year">${cert.year}</div>
        <div>
            <span class="certification-name">${cert.name}</span><br/>
            <span class="certification-org">${cert.org}</span>
        </div>
    `).join('');
    }

    function renderLanguages(languages) {
        return languages.map(lang => `
        <span class="language-name">${lang.name}</span>
        <span>${lang.level}</span>
    `).join('');
    }

    function renderDisabilities(disabilities) {
        return disabilities.map(dis => `
        <span class="disability-name">${dis.name}</span>
        <span>${dis.level}</span>
    `).join('');
    }

    function renderProjects(projects, labels) {
        return projects.map(project => `
        <h2 class="workproject-heading">${project.years} ${project.title}</h2>
        <div class="workproject-intro">
            ${project.intro}
        </div>
        <div class="workproject-details">
            <strong>${labels.position}</strong>
            <div>${project.position}</div>
            ${project.budget ? `<strong>${labels.budget}</strong><div class="project-budget">${project.budget}</div>` : ''}
            ${project.team_size ? `<strong>${labels.team}</strong><div class="project-team">${project.team_size}</div>` : ''}
            <strong>${labels.technology}</strong>
            <div>${project.technology}</div>
            <strong>${labels.role}</strong>
            <div>${project.role}</div>
        </div>
    `).join('');
    }

    function switchLang(lang) {
        currentLang = lang;
        renderCV();
    }

    document.addEventListener('DOMContentLoaded', loadContent);
</script>

</body>
</html>
